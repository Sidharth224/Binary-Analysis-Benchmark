#!/bin/bash

set -x
set -e

#CVE for which binaries are generated
export CVENUM=2020-10064

# Zephyr configuration env variables
export ZEPHYR_SDK_INSTALL_DIR=/home/sidharth/zephyr-sdk-0.11.4
export ZEPHYR_BASE_DIR=/home/sidharth/zephyr-2.4.0/zephyr
export ZEPHYR_TOOLCHAIN_VARIANT=zephyr

# git branch with the CVE and fix for the CVE
export BASE_COMMIT=38970c07abfcddcfc6a5958189f096a55c49594a
export FIX_COMMITS=38970c07abfcddcfc6a5958189f096a55c49594a

# Directories configuration
export SAMPLE_HOME=$ZEPHYR_BASE_DIR/samples
export DATASET_HOME=/home/sidharth/dataset-creation/zephyr-binaries

export CVE_BUILD_DIR=$DATASET_HOME/CVE-2020-10064
             
export OUT_DIR=$DATASET_HOME/CVE-2020-10064/ARM-boards/96Boards-argonkey

# Boards selected for binary generation
export BOARDS="96b_argonkey"

export SAMPLE_DIR="$SAMPLE_HOME/bluetooth/beacon $SAMPLE_HOME/bluetooth/central $SAMPLE_HOME/bluetooth/central_hr $SAMPLE_HOME/bluetooth/central_ht
                    $SAMPLE_HOME/bluetooth/eddystone $SAMPLE_HOME/bluetooth/handsfree $SAMPLE_HOME/bluetooth/hci_pwr_ctrl
                    $SAMPLE_HOME/bluetooth/hci_uart
                    $SAMPLE_HOME/bluetooth/ibeacon $SAMPLE_HOME/bluetooth/peripheral_csc
                    $SAMPLE_HOME/bluetooth/peripheral_dis $SAMPLE_HOME/bluetooth/peripheral_esp
                    $SAMPLE_HOME/bluetooth/peripheral_hr $SAMPLE_HOME/bluetooth/peripheral_ht
                    $SAMPLE_HOME/bluetooth/peripheral_sc_only $SAMPLE_HOME/bluetooth/scan_adv $SAMPLE_HOME/bluetooth/st_ble_sensor
                    $SAMPLE_HOME/boards/96b_argonkey/microphone $SAMPLE_HOME/boards/96b_argonkey/sensors
					$SAMPLE_HOME/boards/bbc_microbit/line_follower_robot
					$SAMPLE_HOME/cpp_synchronization $SAMPLE_HOME/debug/gdbstub
					$SAMPLE_HOME/display/cfb $SAMPLE_HOME/display/grove_display $SAMPLE_HOME/display/lvgl
					$SAMPLE_HOME/drivers/crypto $SAMPLE_HOME/drivers/current_sensing
					$SAMPLE_HOME/drivers/flash_shell
					$SAMPLE_HOME/drivers/led_lp3943 $SAMPLE_HOME/mpu/mpu_test
					$SAMPLE_HOME/net/dhcpv4_client $SAMPLE_HOME/net/dns_resolve
					$SAMPLE_HOME/net/eth_native_posix $SAMPLE_HOME/net/gptp $SAMPLE_HOME/net/ipv4_autoconf
					$SAMPLE_HOME/net/lldp $SAMPLE_HOME/net/lwm2m_client $SAMPLE_HOME/net/mdns_responder
					$SAMPLE_HOME/net/promiscuous_mode $SAMPLE_HOME/net/stats $SAMPLE_HOME/net/syslog_net
					$SAMPLE_HOME/net/telnet $SAMPLE_HOME/net/vlan $SAMPLE_HOME/net/wifi $SAMPLE_HOME/net/zperf
                    $SAMPLE_HOME/philosophers
					$SAMPLE_HOME/portability/cmsis_rtos_v1/philosophers $SAMPLE_HOME/portability/cmsis_rtos_v1/timer_synchronization
					$SAMPLE_HOME/portability/cmsis_rtos_v2/philosophers $SAMPLE_HOME/portability/cmsis_rtos_v2/timer_synchronization
					$SAMPLE_HOME/posix/gettimeofday
					$SAMPLE_HOME/scheduler/metairq_dispatch
					$SAMPLE_HOME/sensor/hts221 $SAMPLE_HOME/sensor/lps22hb
					$SAMPLE_HOME/sensor/lsm6dsl $SAMPLE_HOME/sensor/sensor_shell
					$SAMPLE_HOME/sensor/thermometer
					$SAMPLE_HOME/sensor/vl53l0x 
					$SAMPLE_HOME/subsys/console/echo $SAMPLE_HOME/subsys/console/getchar $SAMPLE_HOME/subsys/console/getline
					$SAMPLE_HOME/synchronization
					$SAMPLE_HOME/testing/integration"

#run the general CVE generation shell script
"$CVE_BUILD_DIR/CVE-2020-10064-build.sh" 