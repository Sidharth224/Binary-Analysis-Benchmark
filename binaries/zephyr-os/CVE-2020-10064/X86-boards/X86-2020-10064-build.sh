#!/bin/bash

set -x
set -e

#CVE for which binaries are generated
export CVENUM=2020-10064

# Zephyr configuration env variables
export ZEPHYR_SDK_INSTALL_DIR=/home/sidharth/zephyr-sdk-0.11.4
export ZEPHYR_BASE_DIR=/home/sidharth/zephyr-2.4.0/zephyr
export ZEPHYR_TOOLCHAIN_VARIANT=zephyr

# git branch with the CVE and fix for the CVE
export BASE_COMMIT=38970c07abfcddcfc6a5958189f096a55c49594a
export FIX_COMMITS=38970c07abfcddcfc6a5958189f096a55c49594a

# Directories configuration
export SAMPLE_HOME=$ZEPHYR_BASE_DIR/samples
export DATASET_HOME=/home/sidharth/dataset-creation/zephyr-binaries

export CVE_BUILD_DIR=$DATASET_HOME/CVE-2020-10064-board

export SAMPLE_DIR="$SAMPLE_HOME/bluetooth/beacon $SAMPLE_HOME/bluetooth/central $SAMPLE_HOME/bluetooth/central_hr $SAMPLE_HOME/bluetooth/central_ht
                    $SAMPLE_HOME/bluetooth/eddystone $SAMPLE_HOME/bluetooth/handsfree $SAMPLE_HOME/bluetooth/hci_pwr_ctrl
                    $SAMPLE_HOME/bluetooth/hci_spi $SAMPLE_HOME/bluetooth/hci_uart $SAMPLE_HOME/bluetooth/hci_usb $SAMPLE_HOME/bluetooth/hci_usb_h4
                    $SAMPLE_HOME/bluetooth/ibeacon $SAMPLE_HOME/bluetooth/ipsp $SAMPLE_HOME/bluetooth/mesh $SAMPLE_HOME/bluetooth/mesh_demo
                    $SAMPLE_HOME/bluetooth/mesh_provisioner $SAMPLE_HOME/bluetooth/peripheral $SAMPLE_HOME/bluetooth/peripheral_csc 
                    $SAMPLE_HOME/bluetooth/peripheral_dis $SAMPLE_HOME/bluetooth/peripheral_esp $SAMPLE_HOME/bluetooth/peripheral_hids
                    $SAMPLE_HOME/bluetooth/peripheral_hr $SAMPLE_HOME/bluetooth/peripheral_ht $SAMPLE_HOME/bluetooth/peripheral_ots
                    $SAMPLE_HOME/bluetooth/peripheral_sc_only $SAMPLE_HOME/bluetooth/scan_adv $SAMPLE_HOME/bluetooth/st_ble_sensor     
                    $SAMPLE_HOME/boards/intel_s1000_crb/audio $SAMPLE_HOME/boards/intel_s1000_crb/dmic $SAMPLE_HOME/boards/intel_s1000_crb/i2s
                    $SAMPLE_HOME/boards/96b_argonkey/sensors $SAMPLE_HOME/display/cfb $SAMPLE_HOME/display/grove_display $SAMPLE_HOME/drivers/can
                    $SAMPLE_HOME/drivers/dac $SAMPLE_HOME/drivers/espi $SAMPLE_HOME/drivers/flash_shell $SAMPLE_HOME/drivers/i2c_fujitsu_fram 
                    $SAMPLE_HOME/drivers/i2s/litex $SAMPLE_HOME/drivers/kscan_touch $SAMPLE_HOME/drivers/ps2 $SAMPLE_HOME/drivers/spi_flash
                    $SAMPLE_HOME/drivers/spi_fujitsu_fram $SAMPLE_HOME/mpu/mpu_test $SAMPLE_HOME/net/wifi $SAMPLE_HOME/net/eth_native_posix
                    $SAMPLE_HOME/net/gsm_modem $SAMPLE_HOME/net/ipv4_autoconf $SAMPLE_HOME/net/telnet $SAMPLE_HOME/net/vlan 
                    $SAMPLE_HOME/portability/cmsis_rtos_v1/philosophers $SAMPLE_HOME/portability/cmsis_rtos_v2/timer_synchronization
                    $SAMPLE_HOME/posix/gettimeofday $SAMPLE_HOME/scheduler/metairq_dispatch $SAMPLE_HOME/tfm_integration/tfm_ipc
                    $SAMPLE_HOME/tfm_integration/psa_level_1 $SAMPLE_HOME/userspace/shared_mem $SAMPLE_HOME/video/tcpserversink"

export OUT_DIR=$DATASET_HOME/CVE-2020-10064-board/X86-boards

# Boards selected for binary generation
export BOARDS="acrn minnowboard qemu_x86 up_squared"
# export BOARDS="minnowboard qemu_x86 up_squared"
# export BOARDS="qemu_x86 up_squared"
# export BOARDS="up_squared"



#run the general CVE generation shell script
"$CVE_BUILD_DIR/CVE-2020-10064-build.sh" 

