#!/bin/bash

set -x
set -e

export OLD_CVE1=CVE-2021-3329
export OLD_CVE2=2021-3329
export NEW_CVE1=CVE-2021-3330
export NEW_CVE2=2021-3330
export ZEPHYR_VER=2.4.0

export BASE_COMMIT_AS=a980762f70d7048825e6ce9e42ceb6b5f87a5e44
export FIX_COMMIT_AS=a980762f70d7048825e6ce9e42ceb6b5f87a5e44
export PATCHES_LIST="fix-CVE-2021-3323.patch ieee802154_reass_timeout.patch spi_sam_flat_read.patch"

export DATBASE_HOME=/home/sidharth/dataset-creation/zephyr-binaries

mkdir $DATBASE_HOME/$NEW_CVE1/ARC-Boards
mkdir $DATBASE_HOME/$NEW_CVE1/ARM-Boards
mkdir $DATBASE_HOME/$NEW_CVE1/RISCV-Boards
mkdir $DATBASE_HOME/$NEW_CVE1/X86-Boards

cp $DATBASE_HOME/$OLD_CVE1/ARC-Boards/ARC-$OLD_CVE2.sh $DATBASE_HOME/$NEW_CVE1/ARC-Boards/ARC-$NEW_CVE2.sh
cp $DATBASE_HOME/$OLD_CVE1/ARM-Boards/ARM-$OLD_CVE2.sh $DATBASE_HOME/$NEW_CVE1/ARM-Boards/ARM-$NEW_CVE2.sh
cp $DATBASE_HOME/$OLD_CVE1/RISCV-Boards/RISCV-$OLD_CVE2.sh $DATBASE_HOME/$NEW_CVE1/RISCV-Boards/RISCV-$NEW_CVE2.sh
cp $DATBASE_HOME/$OLD_CVE1/X86-Boards/X86-$OLD_CVE2.sh $DATBASE_HOME/$NEW_CVE1/X86-Boards/X86-$NEW_CVE2.sh
cp $DATBASE_HOME/$OLD_CVE1/$OLD_CVE1-build.sh $DATBASE_HOME/$NEW_CVE1/$NEW_CVE1-build.sh

"$DATBASE_HOME/$NEW_CVE1/ARC-Boards/ARC-$NEW_CVE2.sh" 
"$DATBASE_HOME/$NEW_CVE1/ARM-Boards/ARM-$NEW_CVE2.sh"
"$DATBASE_HOME/$NEW_CVE1/RISCV-Boards/RISCV-$NEW_CVE2.sh"
"$DATBASE_HOME/$NEW_CVE1/X86-Boards/X86-$NEW_CVE2.sh"